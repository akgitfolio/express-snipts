feat(middleware): Add support for async middleware

Adds support for writing asynchronous middleware functions, allowing for improved control over request execution flow. This feature solves issues with request handling in the previous implementation.
